
<!DOCTYPE html>
<html class="writer-html5" lang="ru" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Скриптовая задача &mdash; ECOS</title>
      <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../../_static/css/main_theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
        <script src="../../../../../_static/jquery.js"></script>
        <script src="../../../../../_static/underscore.js"></script>
        <script src="../../../../../_static/doctools.js"></script>
        <script src="../../../../../_static/translations.js"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Алфавитный указатель" href="../../../../../genindex.html" />
    <link rel="search" title="Поиск" href="../../../../../search.html" />
    <link rel="next" title="Уведомление" href="ecos_bpmn_components_notifications.html" />
    <link rel="prev" title="Пользовательская задача" href="ecos_bpmn_components_user_task.html" />


 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../../index.html" class="icon icon-home"> Citeck ECOS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Поиск в документации" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Меню навигации">
              <p class="caption" role="heading"><span class="caption-text">Знакомство с ECOS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../%D0%92%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5.html">Знакомство с ECOS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Раздел 2</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../%D0%9F%D1%80%D0%B8%D0%BC%D0%B5%D1%80%20%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B8%20%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%B0.html">Пример создания приложения ECOS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Раздел 3</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../../../%D0%91%D0%B0%D0%B7%D0%B0%20%D0%B7%D0%BD%D0%B0%D0%BD%D0%B8%D0%B9%20%D0%BF%D0%BE%20%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B5.html">Конструктор low-code</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../ecos_artifacts.html">ECOS Артефакты</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ecos_applications.html">ECOS Приложения</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../%D0%A2%D0%B8%D0%BF%D1%8B_%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85.html">Типы данных</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Aspects.html">Аспекты</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../interface.html">Интерфейс</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ui_actions.html">Действия</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../../%D0%9F%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D1%8B.html">Бизнес-процессы</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../../BPMN_ecos.html">Платформа бизнес-процессов (ECOS BPMN)</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../ecos_bpmn_overview.html">Общее описание Ecos BPMN</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../ecos_bpmn_base_operations.html">Базовые операции</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../../ecos_bpmn_editor.html">Моделирование бизнес-процесса</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../BPMN_flowable.html">Редактор бизнес-процессов (BPMN) с использованием Flowable</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../CMMN.html">Редактор сценариев (CMMN)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../CMMN_BPMN.html">Работа в связке CMMN - BPMN</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../notifications.html">Уведомления</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Admin_Page.html">Страница администратора</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../%D0%A2%D0%B5%D0%BC%D1%8B_%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D1%84%D0%B5%D0%B9%D1%81%D0%B0.html">Настройка темы интерфейса</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../Best_practice.html">Best practice</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Администрирование</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../%D0%90%D0%B4%D0%BC%D0%B8%D0%BD%D0%B8%D1%81%D1%82%D1%80%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5.html">Администрирование</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Архитектура</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../%D0%90%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D0%B0.html">Архитектура</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Общая база знаний</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../general/%D0%A2%D0%B5%D1%80%D0%BC%D0%B8%D0%BD%D1%8B.html">Термины</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../general/ECOS_Records.html">ECOS Records API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../general/ECOS_Records_examples.html">Примеры запросов ECOS Records</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../general/ecos_data.html">ECOS Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../general/System_attributes.html">Системные атрибуты</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../general/%D0%AF%D0%B7%D1%8B%D0%BA_%D0%BF%D1%80%D0%B5%D0%B4%D0%B8%D0%BA%D0%B0%D1%82%D0%BE%D0%B2.html">Язык предикатов</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../general/Transactions.html">Транзакции в ECOS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../general/Commands.html">Команды</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../general/Aspects.html">Аспекты</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../general/Microservices.html">Микросервисы</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../general/ECOS_WebAPI.html">ECOS WebAPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../general/%D0%93%D0%B5%D0%BD%D0%B5%D1%80%D0%B0%D1%86%D0%B8%D1%8F%20%D0%B4%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82%D0%BE%D0%B2.html">Микросервис Трансформации. Генерация документов по шаблонам</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../general/Preview.html">Предпросмотр документов</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../general/Events.html">Работа с событиями (events)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../general/Processes.html">Бизнес-процессы</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../general/Alfresco.html">Alfresco и информация о миграции</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../general/How_To.html">How To</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Интеграции</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../integration/API%20ECOS%20%D0%B4%D0%BB%D1%8F%20%D0%B2%D0%BD%D0%B5%D1%88%D0%BD%D0%B8%D1%85%20%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC.html">Примеры использования Records API для внешних систем</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../integration/Camel_DSL.html">Использование Camel DSL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../integration/data%20sources.html">Источники данных</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../integration/records%20sources.html">Создание новых источников записей через Web интерфейс</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../integration/OSGI.html">Функционал загрузки OSGI пакетов</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../integration/Filesystem%20Export.html">Выгрузка записей из любой базы данных в файловую систему микросервиса интеграции</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../integration/Mail%20Processing.html">Импорт писем IMAP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../integration/file_import.html">Файловый импорт в систему</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../integration/2_instances.html">Общение между двумя и более инстансами ECOS’а через команды и события</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../integration/EDI_integration.html">Интеграция с ЭДО провайдерами</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../integration/Counterparties%20sync.html">Синхронизация контрагентов</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../integration/currency.html">Интеграция курсов валют</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../integration/ECOS%20Synchronization.html">Поддержка выгрузки нод alfresco в таблицу базы данных</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Раздел 8</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../%D0%9C%D0%BE%D0%B1%D0%B8%D0%BB%D1%8C%D0%BD%D0%BE%D0%B5%20%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5.html">Мобильное приложение</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Меню навигации для мобильных устройств" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Citeck ECOS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Навигация по страницам">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../../../%D0%91%D0%B0%D0%B7%D0%B0%20%D0%B7%D0%BD%D0%B0%D0%BD%D0%B8%D0%B9%20%D0%BF%D0%BE%20%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B5.html">Конструктор low-code</a> &raquo;</li>
          <li><a href="../../../../%D0%9F%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D1%8B.html">Бизнес-процессы</a> &raquo;</li>
          <li><a href="../../../BPMN_ecos.html">Платформа бизнес-процессов (ECOS BPMN)</a> &raquo;</li>
          <li><a href="../../ecos_bpmn_editor.html">Моделирование бизнес-процесса</a> &raquo;</li>
          <li><a href="../ecos_bpmn_components.html">Компоненты Ecos BPMN</a> &raquo;</li>
      <li>Скриптовая задача</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../../_sources/settings_kb/processes/ecos_bpmn/editor/components/ecos_bpmn_components_script_task.rst.txt" rel="nofollow"> Просмотреть исходный код страницы</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="id1">
<h1><a class="toc-backref" href="#id8">Скриптовая задача</a><a class="headerlink" href="#id1" title="Ссылка на этот заголовок"></a></h1>
<div class="contents topic" id="id2">
<span id="script-task"></span><p class="topic-title">Содержание</p>
<ul class="simple">
<li><p><a class="reference internal" href="#id1" id="id8">Скриптовая задача</a></p>
<ul>
<li><p><a class="reference internal" href="#id3" id="id9">Атрибуты и форма</a></p></li>
<li><p><a class="reference internal" href="#id5" id="id10">Доступные переменные</a></p>
<ul>
<li><p><a class="reference internal" href="#id6" id="id11">Переменные процесса</a></p></li>
<li><p><a class="reference internal" href="#execution" id="id12">Execution</a></p></li>
<li><p><a class="reference internal" href="#document" id="id13">Document</a></p></li>
<li><p><a class="reference internal" href="#records" id="id14">Records</a></p></li>
<li><p><a class="reference internal" href="#ecos-config" id="id15">Ecos Config</a></p></li>
<li><p><a class="reference internal" href="#datavalue" id="id16">DataValue</a></p></li>
<li><p><a class="reference internal" href="#weburl" id="id17">WebUrl</a></p></li>
<li><p><a class="reference internal" href="#tasks" id="id18">Tasks</a></p></li>
<li><p><a class="reference internal" href="#logger" id="id19">Logger</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<section id="id3">
<h2><a class="toc-backref" href="#id9">Атрибуты и форма</a><a class="headerlink" href="#id3" title="Ссылка на этот заголовок"></a></h2>
<p>Используется язык JavaScript.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../../../../_images/59.png"><img alt="../../../../../_images/59.png" class="align-center" src="../../../../../_images/59.png" style="width: 300px;" /></a>
</div></blockquote>
<table class="colwidths-given tight-table docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Указать <strong>Имя</strong></p></td>
<td><a class="reference internal image-reference" href="../../../../../_images/60.png"><img alt="../../../../../_images/60.png" class="align-center" src="../../../../../_images/60.png" style="width: 300px;" /></a>
</td>
</tr>
<tr class="row-even"><td><p>Указать <strong>скрипт</strong></p></td>
<td><a class="reference internal image-reference" href="../../../../../_images/61.png"><img alt="../../../../../_images/61.png" class="align-center" src="../../../../../_images/61.png" style="width: 300px;" /></a>
</td>
</tr>
<tr class="row-odd"><td><p>Настройки асинхронности, см. подробнее о <a class="reference external" href="https://camunda.com/blog/2014/07/advanced-asynchronous-continuations/">асинхронных задачах</a></p></td>
<td><a class="reference internal image-reference" href="../../../../../_images/62.png"><img alt="../../../../../_images/62.png" class="align-center" src="../../../../../_images/62.png" style="width: 300px;" /></a>
</td>
</tr>
</tbody>
</table>
</section>
<section id="id5">
<h2><a class="toc-backref" href="#id10">Доступные переменные</a><a class="headerlink" href="#id5" title="Ссылка на этот заголовок"></a></h2>
<section id="id6">
<h3><a class="toc-backref" href="#id11">Переменные процесса</a><a class="headerlink" href="#id6" title="Ссылка на этот заголовок"></a></h3>
<p>Во время выполнения скриптов доступны все переменные процесса, видимые в текущей области.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">//someVar - переменная процесса</span>
<span class="nx">print</span><span class="p">(</span><span class="s2">&quot;someVar: &quot;</span> <span class="o">+</span> <span class="nx">someVar</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="execution">
<h3><a class="toc-backref" href="#id12">Execution</a><a class="headerlink" href="#execution" title="Ссылка на этот заголовок"></a></h3>
<p id="id7"><code class="docutils literal notranslate"><span class="pre">execution</span></code> - переменная, которая всегда доступна, если скрипт выполняется в области выполнения (например, в Script Task). <a class="reference external" href="https://docs.camunda.org/javadoc/camunda-bpm-platform/7.17/org/camunda/bpm/engine/delegate/DelegateExecution.html">(DelegateExecution)</a></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">// получение переменной процесса</span>
<span class="kd">var</span> <span class="nx">sum</span> <span class="o">=</span> <span class="nx">execution</span><span class="p">.</span><span class="nx">getVariable</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">);</span>

<span class="c1">// установление переменной процесса</span>
<span class="nx">execution</span><span class="p">.</span><span class="nx">setVariable</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="nx">x</span> <span class="o">+</span> <span class="mf">15</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="document">
<h3><a class="toc-backref" href="#id13">Document</a><a class="headerlink" href="#document" title="Ссылка на этот заголовок"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">document</span></code> - является скриптовым представлением документа <a class="reference external" href="https://gitlab.citeck.ru/ecos-community/ecos-records/-/blob/master/ecos-records/src/main/java/ru/citeck/ecos/records3/record/atts/computed/script/AttValueScriptCtx.kt">AttValueScriptCtx</a> , по которому идет БП.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">//получение атрибута документа</span>
<span class="kd">var</span> <span class="nx">created</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="s2">&quot;_created&quot;</span><span class="p">);</span>

<span class="c1">//установление атрибуту документа указанного значения</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">att</span><span class="p">(</span><span class="s2">&quot;firArchiveBoxNumber&quot;</span><span class="p">,</span> <span class="mf">123</span><span class="p">);</span>
<span class="c1">//сохранение</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>

<span class="c1">//сброс состояния документа, если ранее были внесены изменения через att()</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">att</span><span class="p">(</span><span class="s2">&quot;firArchiveBoxNumber&quot;</span><span class="p">,</span> <span class="mf">123</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
</pre></div>
</div>
</section>
<section id="records">
<h3><a class="toc-backref" href="#id14">Records</a><a class="headerlink" href="#records" title="Ссылка на этот заголовок"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Records</span></code> - это сервис, который предоставляет доступ к функциям работы с рекордами <a class="reference external" href="https://gitlab.citeck.ru/ecos-community/ecos-records/-/blob/master/ecos-records/src/main/java/ru/citeck/ecos/records3/record/atts/computed/script/RecordsScriptService.kt">RecordsScriptService</a>.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">//Получение скриптового представление указанного рекорда</span>
<span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nx">Records</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;emodel/doc@111&quot;</span><span class="p">);</span>

<span class="c1">//Query рекордов</span>
<span class="kd">var</span> <span class="nx">queryCommentsResult</span> <span class="o">=</span> <span class="nx">Records</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span>
    <span class="nx">sourceId</span><span class="o">:</span> <span class="s2">&quot;emodel/comment&quot;</span><span class="p">,</span>
    <span class="nx">language</span><span class="o">:</span> <span class="s2">&quot;predicate&quot;</span><span class="p">,</span>
    <span class="nx">query</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">a</span><span class="o">:</span> <span class="s2">&quot;record&quot;</span><span class="p">,</span>
        <span class="nx">t</span><span class="o">:</span> <span class="s2">&quot;eq&quot;</span><span class="p">,</span>
        <span class="nx">v</span><span class="o">:</span> <span class="s2">&quot;emodel/doc@123&quot;</span>
    <span class="p">}</span>
<span class="p">},</span> <span class="p">{</span>
    <span class="nx">text</span><span class="o">:</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
    <span class="nx">created</span><span class="o">:</span> <span class="s2">&quot;_created&quot;</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">firstComment</span> <span class="o">=</span> <span class="nx">queryCommentsResult</span><span class="p">.</span><span class="nx">records</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">firstComment</span><span class="p">.</span><span class="nx">text</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">created</span> <span class="o">=</span> <span class="nx">firstComment</span><span class="p">.</span><span class="nx">created</span><span class="p">;</span>

<span class="nx">print</span><span class="p">(</span><span class="s2">&quot;comment: &quot;</span> <span class="o">+</span> <span class="nx">text</span> <span class="o">+</span> <span class="s2">&quot; created on &quot;</span> <span class="o">+</span> <span class="nx">created</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="ecos-config">
<h3><a class="toc-backref" href="#id15">Ecos Config</a><a class="headerlink" href="#ecos-config" title="Ссылка на этот заголовок"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">Config</span></code> - предоставляет доступ к Конфигурации Ecos по ключу в формате <code class="docutils literal notranslate"><span class="pre">&lt;область&gt;$&lt;идентификатор&gt;</span></code>.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">get(key:</span> <span class="pre">String):</span> <span class="pre">DataValue</span></code> - получение значения по ключу</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getOrDefault(key:</span> <span class="pre">String,</span> <span class="pre">defaultValue:</span> <span class="pre">Any):</span> <span class="pre">DataValue</span></code> - получение значения по ключу, если значение не найдено, то возвращается значение по умолчанию</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">getNotNull(key:</span> <span class="pre">String):</span> <span class="pre">DataValue</span></code> - получение значения по ключу, если значение null, то выбрасывается исключение</p></li>
</ul>
</div></blockquote>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="c1">//получение значения конфигурации по ключу и приведение к типу String</span>
<span class="kd">var</span> <span class="nx">serviceDeskEmailFrom</span> <span class="o">=</span> <span class="nx">Config</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;app/service-desk$send-sd-email-from&quot;</span><span class="p">).</span><span class="nx">asText</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="datavalue">
<h3><a class="toc-backref" href="#id16">DataValue</a><a class="headerlink" href="#datavalue" title="Ссылка на этот заголовок"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">DataValue</span></code> - объект, позволяющий сконвертировать данные в стркутуру <a class="reference external" href="https://gitlab.citeck.ru/ecos-community/ecos-process/-/blob/develop/src/main/java/ru/citeck/ecos/process/domain/bpmn/engine/camunda/impl/variables/convert/BpmnDataValue.kt">BpmnDataValue</a> для удобной работы с json представлением, это позволяет безопасно обращаться к полям, получать значения по умолчанию, приводить к нужному типу, сохранять данные в execution и многое другое, подробнее см. методы класса.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DataValue.of(content:</span> <span class="pre">Any?)</span></code> - создает объект DataValue из любого объекта, если объект не может быть сконвертирован в DataValue, то возвращается пустой объект DataValue.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DataValue.createObj()</span></code> - создает пустой объект DataValue.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DataValue.createArr()</span></code> - создает пустой массив DataValue.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DataValue.createStr(value:</span> <span class="pre">Any?)</span></code> - создает строковое представление переданного значения.</p></li>
</ul>
</div></blockquote>
<p>Пример использования:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="nx">DataValue</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="nx">someExampleEventStructure</span><span class="p">);</span>

<span class="nx">print</span><span class="p">(</span><span class="s2">&quot;---HELLO FROM SCRIPT---&quot;</span><span class="p">);</span>


<span class="nx">print</span><span class="p">(</span><span class="s2">&quot;event id from base: &quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;_meta&quot;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">));</span>
<span class="nx">print</span><span class="p">(</span><span class="s2">&quot;event id from $: &quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;$._meta.id&quot;</span><span class="p">));</span>
<span class="nx">print</span><span class="p">(</span><span class="s2">&quot;event id from JsonPointer: &quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/_meta/id&quot;</span><span class="p">));</span>

<span class="nx">print</span><span class="p">(</span><span class="s2">&quot;event time as instant: &quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/_meta/time&quot;</span><span class="p">).</span><span class="nx">takeAsInstant</span><span class="p">());</span>
<span class="nx">print</span><span class="p">(</span><span class="s2">&quot;event field names list: &quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">fieldNamesList</span><span class="p">());</span>

<span class="nx">print</span><span class="p">(</span><span class="s2">&quot;call undefined prop is safe: &quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;/_meta/a/b/c/&quot;</span><span class="p">));</span>

<span class="nx">print</span><span class="p">(</span><span class="s2">&quot;event id is boolean &quot;</span> <span class="o">+</span> <span class="nx">event</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;_meta&quot;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">).</span><span class="nx">isBoolean</span><span class="p">());</span>


<span class="nx">print</span><span class="p">(</span><span class="s2">&quot;-------END--------------&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>DataValue может быть сохранен в execution процесса с последующим извлечением и использованием.</p>
<p>Сохраняем в execution:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">a</span><span class="o">:</span> <span class="s2">&quot;b&quot;</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">dArr</span> <span class="o">=</span> <span class="nx">DataValue</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="nx">arr</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">dObj</span> <span class="o">=</span> <span class="nx">DataValue</span><span class="p">.</span><span class="k">of</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span>

<span class="nx">execution</span><span class="p">.</span><span class="nx">setVariable</span><span class="p">(</span><span class="s2">&quot;dArr&quot;</span><span class="p">,</span> <span class="nx">dArr</span><span class="p">);</span>
<span class="nx">execution</span><span class="p">.</span><span class="nx">setVariable</span><span class="p">(</span><span class="s2">&quot;dObj&quot;</span><span class="p">,</span> <span class="nx">dObj</span><span class="p">);</span>
</pre></div>
</div>
<p>Обращаемся к сохраненным в execution переменным в другом скрипте</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">print</span><span class="p">(</span><span class="s2">&quot;----------&quot;</span><span class="p">);</span>

<span class="nx">print</span><span class="p">(</span><span class="s2">&quot;dArr: &quot;</span> <span class="o">+</span> <span class="nx">dArr</span><span class="p">);</span>
<span class="nx">print</span><span class="p">(</span><span class="s2">&quot;dArr 0: &quot;</span> <span class="o">+</span> <span class="nx">dArr</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">));</span>

<span class="nx">print</span><span class="p">(</span><span class="s2">&quot;dObj: &quot;</span> <span class="o">+</span> <span class="nx">dObj</span><span class="p">);</span>
<span class="nx">print</span><span class="p">(</span><span class="s2">&quot;dObj a: &quot;</span> <span class="o">+</span> <span class="nx">dObj</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">));</span>

<span class="nx">print</span><span class="p">(</span><span class="s2">&quot;----------&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Результат:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">----------</span>
<span class="n">dArr</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;0&quot;</span><span class="p">:</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">:</span><span class="s2">&quot;b&quot;</span><span class="p">}</span>
<span class="n">dArr</span> <span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;a&quot;</span>
<span class="n">dObj</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="s2">&quot;b&quot;</span><span class="p">}</span>
<span class="n">dObj</span> <span class="n">a</span><span class="p">:</span> <span class="s2">&quot;b&quot;</span>
<span class="o">----------</span>
</pre></div>
</div>
</section>
<section id="weburl">
<h3><a class="toc-backref" href="#id17">WebUrl</a><a class="headerlink" href="#weburl" title="Ссылка на этот заголовок"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">webUrl</span></code> - переменная возвращает настроенный веб url сервера</p>
</section>
<section id="tasks">
<h3><a class="toc-backref" href="#id18">Tasks</a><a class="headerlink" href="#tasks" title="Ссылка на этот заголовок"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">tasks</span></code> - сервис для манипуляций над задачами.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tasks.completeActiveTasks(execution:</span> <span class="pre">DelegateExecution)</span></code> - завершает все активные задачи по инстансу процесса из [DelegateExecution.getProcessInstanceId]. Задачи завершаются с результатом <em>defaultDone: Выполнено</em>.</p></li>
</ul>
</div></blockquote>
</section>
<section id="logger">
<h3><a class="toc-backref" href="#id19">Logger</a><a class="headerlink" href="#logger" title="Ссылка на этот заголовок"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">log</span></code> -  логгер, пишет в микросервис ecos-process, дополнительно выводится информация о execution. Для настройки уровня логирования используется класс <code class="docutils literal notranslate"><span class="pre">ru.citeck.ecos.process.domain.bpmn.engine.camunda.services.beans.ScriptLogger</span></code>. <br> Поддерживаемые методы:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">log.info(message:</span> <span class="pre">String)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">log.warn(message:</span> <span class="pre">String)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">log.error(message:</span> <span class="pre">String)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">log.debug(message:</span> <span class="pre">String)</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">log.trace(message:</span> <span class="pre">String)</span></code></p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Примечание</p>
<p>Читай подробнее о <a class="reference external" href="https://docs.camunda.org/manual/7.14/user-guide/process-engine/scripting/">scripting в Camunda</a></p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Нижняя область">
        <a href="ecos_bpmn_components_user_task.html" class="btn btn-neutral float-left" title="Пользовательская задача" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Предыдущая</a>
        <a href="ecos_bpmn_components_notifications.html" class="btn btn-neutral float-right" title="Уведомление" accesskey="n" rel="next">Следующая <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Citeck.</p>
  </div>

  Собрано при помощи <a href="https://www.sphinx-doc.org/">Sphinx</a> с использованием
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">темы,</a>
    предоставленной <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>